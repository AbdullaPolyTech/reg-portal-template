<%- include("../partials/header", { title: "Admin - Users" }) %>
<%- include("../partials/alerts") %>

<div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
  <div>
    <h1 class="h3 mb-1">User management</h1>
    <p class="text-secondary mb-0">View accounts, update roles, and remove users.</p>
  </div>
  <a class="btn btn-dark" href="/admin/users/new">Create user</a>
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Email</th>
            <th scope="col">Role</th>
            <th scope="col">Applications</th>
            <th scope="col">Created</th>
            <th scope="col" class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% (users || []).forEach((user) => { %>
            <tr>
              <td class="fw-semibold"><%= user.full_name %></td>
              <td><%= user.email %></td>
              <td>
                <span class="badge text-bg-<%= user.role === "ADMIN" ? "primary" : "secondary" %>">
                  <%= user.role %>
                </span>
              </td>
              <td><%= user.application_count %></td>
              <td class="text-nowrap"><%= user.created_at %></td>
              <td class="text-end">
                <div class="d-flex flex-wrap justify-content-end gap-2">
                  <form class="d-flex gap-2 align-items-center" method="post" action="/admin/users/<%= user.id %>/role">
                    <select class="form-select form-select-sm" name="role">
                      <option value="USER" <%= user.role === "USER" ? "selected" : "" %>>User</option>
                      <option value="ADMIN" <%= user.role === "ADMIN" ? "selected" : "" %>>Admin</option>
                    </select>
                    <button class="btn btn-sm btn-outline-primary" type="submit">Update</button>
                  </form>
                  <form method="post" action="/admin/users/<%= user.id %>/delete">
                    <button
                      class="btn btn-sm btn-outline-danger"
                      type="submit"
                      <%= currentUser && currentUser.id === user.id ? "disabled" : "" %>
                    >
                      Remove
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<%- include("../partials/footer") %>