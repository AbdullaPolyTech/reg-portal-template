<%- include("../partials/header", { title: "Admin - Application" }) %>
<%- include("../partials/alerts") %>

<% const statusClasses = { APPROVED: "success", REJECTED: "danger", PENDING: "warning" }; %>
<div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
  <h1 class="h3 mb-0">Application #<%= application.id %></h1>
  <span class="badge text-bg-<%= statusClasses[application.status] || "secondary" %>">
    <%= application.status %>
  </span>
</div>

<div class="card shadow-sm mb-4">
  <div class="card-body">
    <div class="row g-3">
      <div class="col-12 col-md-6">
        <div class="text-uppercase text-secondary small">Applicant</div>
        <div class="fw-semibold"><%= application.full_name %></div>
        <div class="text-secondary"><%= application.email %></div>
      </div>
      <div class="col-12 col-md-6">
        <div class="text-uppercase text-secondary small">Submitted</div>
        <div class="fw-semibold"><%= application.created_at %></div>
      </div>
      <div class="col-12 col-md-6">
        <div class="text-uppercase text-secondary small">Organization</div>
        <div class="fw-semibold"><%= application.organization || "-" %></div>
      </div>
      <div class="col-12 col-md-6">
        <div class="text-uppercase text-secondary small">Phone</div>
        <div class="fw-semibold"><%= application.phone || "-" %></div>
      </div>
      <div class="col-12">
        <div class="text-uppercase text-secondary small">Message</div>
        <div class="fw-semibold"><%= application.message || "-" %></div>
      </div>
      <div class="col-12">
        <div class="text-uppercase text-secondary small">Admin note</div>
        <div class="fw-semibold"><%= application.admin_note || "-" %></div>
      </div>
    </div>
  </div>
</div>

<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h2 class="h5 mb-3">Uploaded files</h2>
    <% if (files && files.length) { %>
      <ul class="list-group list-group-flush">
        <% files.forEach((file) => { %>
          <li class="list-group-item d-flex align-items-center justify-content-between">
            <div>
              <div class="fw-semibold"><%= file.original_name %></div>
              <div class="text-secondary small"><%= file.mime_type %> â€¢ <%= (file.size / 1024 / 1024).toFixed(2) %> MB</div>
            </div>
            <a class="btn btn-sm btn-outline-primary" href="/admin/files/<%= file.id %>">Download</a>
          </li>
        <% }) %>
      </ul>
    <% } else { %>
      <div class="text-secondary">No files uploaded.</div>
    <% } %>
  </div>
</div>

  <form method="post" action="/admin/applications/<%= application.id %>/status" class="card shadow-sm">
  <div class="card-body">
    <h2 class="h5 mb-3">Update status</h2>
    <div class="row g-3">
      <div class="col-12 col-md-4">
        <label class="form-label">Set status</label>
        <select class="form-select" name="status">
          <option value="PENDING" <%= application.status === "PENDING" ? "selected" : "" %>>PENDING</option>
          <option value="APPROVED" <%= application.status === "APPROVED" ? "selected" : "" %>>APPROVED</option>
          <option value="REJECTED" <%= application.status === "REJECTED" ? "selected" : "" %>>REJECTED</option>
        </select>
      </div>
      <div class="col-12">
        <label class="form-label">Admin note</label>
        <textarea class="form-control" name="admin_note" rows="4"><%= application.admin_note || "" %></textarea>
      </div>
    </div>
    <div class="d-flex flex-wrap gap-2 mt-3">
      <button class="btn btn-dark" type="submit">Save changes</button>
      <a class="btn btn-outline-secondary" href="/admin/applications">Back to applications</a>
    </div>
  </div>
</form>

<%- include("../partials/footer") %>
