<%- include("../partials/header", { title: "Audit Logs" }) %>

<div class="d-flex align-items-center justify-content-between mb-3">
  <h1 class="h3 mb-0">Audit Logs</h1>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    <% if (!logs.length) { %>
      <p class="text-muted mb-0">No audit entries yet.</p>
    <% } else { %>
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th scope="col">Timestamp</th>
              <th scope="col">Actor</th>
              <th scope="col">Action</th>
              <th scope="col">Entity</th>
              <th scope="col">Metadata</th>
            </tr>
          </thead>
          <tbody>
            <% logs.forEach((log) => { %>
              <tr>
                <td class="text-nowrap"><%= log.created_at %></td>
                <td>
                  <% if (log.full_name) { %>
                    <div><strong><%= log.full_name %></strong></div>
                    <div class="text-muted small"><%= log.email %></div>
                  <% } else { %>
                    <span class="text-muted">System</span>
                  <% } %>
                </td>
                <td><span class="badge bg-secondary"><%= log.action %></span></td>
                <td>
                  <div><%= log.entity_type %></div>
                  <% if (log.entity_id) { %>
                    <div class="text-muted small">ID <%= log.entity_id %></div>
                  <% } %>
                </td>
                <td>
                  <% if (log.metadata) { %>
                    <pre class="mb-0 small"><%= JSON.stringify(log.metadata, null, 2) %></pre>
                  <% } else { %>
                    <span class="text-muted">â€”</span>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>
</div>

<nav class="mt-3">
  <ul class="pagination">
    <li class="page-item <%= pagination.currentPage <= 1 ? 'disabled' : '' %>">
      <a class="page-link" href="<%= pagination.basePath %>?page=<%= pagination.currentPage - 1 %>">Previous</a>
    </li>
    <li class="page-item disabled">
      <span class="page-link">
        Page <%= pagination.currentPage %> of <%= pagination.totalPages %>
      </span>
    </li>
    <li class="page-item <%= pagination.currentPage >= pagination.totalPages ? 'disabled' : '' %>">
      <a class="page-link" href="<%= pagination.basePath %>?page=<%= pagination.currentPage + 1 %>">Next</a>
    </li>
  </ul>
</nav>

<%- include("../partials/footer") %>